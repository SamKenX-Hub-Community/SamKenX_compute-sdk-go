name: "Bootstrap Integration Test"
description: "Sets up an environment for our integration tests"
runs:
  using: "composite"
  steps:
    - run: |
        echo "Install Fastly CLI 3.0.0"
        wget https://github.com/fastly/cli/releases/download/v3.0.0/fastly_3.0.0_linux_amd64.deb
        sudo apt install ./fastly_3.0.0_linux_amd64.deb
      shell: "bash"
    - run: |
        echo "Install Viceroy 0.2.14..."
        wget https://github.com/fastly/Viceroy/releases/download/v0.2.14/viceroy_v0.2.14_linux-amd64.tar.gz
        mkdir -p $HOME/bin
        tar -xzf viceroy_v0.2.14_linux-amd64.tar.gz --directory $HOME/bin
        echo "$HOME/bin" >> $GITHUB_PATH
      shell: "bash"
    - run: |
        echo "Install TinyGo 0.23.0..."
        wget https://github.com/tinygo-org/tinygo/releases/download/v0.23.0/tinygo_0.23.0_amd64.deb
        echo "7d11ed3d88e0e594e0e746c260c38cc34f225bdc860493005f79e14089b96b2ed2c1bcb62434dc19674dbd9761514770da5b8e4278e369fa492772ce97a1f57b tinygo_0.23.0_amd64.deb" | sha512sum --check
        sudo dpkg -i tinygo_0.23.0_amd64.deb
        echo "/usr/local/tinygo/bin" >> $GITHUB_PATH
      shell: "bash"
